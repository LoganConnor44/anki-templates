<!DOCTYPE html>
<html dir="ltr" lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=5.0" />
		<title>Stencil Component Starter</title>

		<script type="module" src="/build/beautify-chinese-study.esm.js"></script>
		<script nomodule src="/build/beautify-chinese-study.js"></script>
	</head>

	<body>
		<style>
			body {
				background-color: black;
				margin: 0;
				display: flex;
				min-height: 100dvh;
				flex-direction: column;
			}
		</style>

		<material-beautify-chinese-study
			id="asdf"
			primary-character="刻苦"
			primary-character-sentence="她说现在世界和平了，武术没用了，应该刻苦读书才对！"
			card-type="tones"
			meaning="Hardworking"
			sentence-meaning="She says that now the world is peaceful and there's no use for martial arts, that we be hardworking students."
			card-orientation="question"
			preferred-phonic="zhuyin"
			force-auto-generation
		/>

		<script>
			let previewElement = document.querySelector('material-beautify-chinese-study');
			const dynamicAttributes = new Set(['card-type', 'card-orientation']);
			const baseAttributes = {};
			if (previewElement) {
				Array.from(previewElement.attributes).forEach(attr => {
					if (!dynamicAttributes.has(attr.name)) {
						baseAttributes[attr.name] = attr.value;
					}
				});
			}

			const cardTypes = ['recognition', 'sentence', 'tones', 'writing', 'audio', 'secondary-sentence', 'secondary-recognition'];
			const playableCardTypes = cardTypes.filter(type => type !== 'writing' && type !== 'audio');
			const orientations = ['question', 'answer'];
			let cardTypeIndex = 0;
			let orientationIndex = 0;
			let lastOrientation = null;

			let statusBadge;
			if (previewElement) {
				statusBadge = document.createElement('div');
				statusBadge.id = 'card-preview-status';
				statusBadge.style.position = 'fixed';
				statusBadge.style.top = '1rem';
				statusBadge.style.right = '1rem';
				statusBadge.style.padding = '0.5rem 0.75rem';
				statusBadge.style.background = 'rgba(0, 0, 0, 0.65)';
				statusBadge.style.color = '#fff';
				statusBadge.style.fontFamily = 'system-ui, sans-serif';
				statusBadge.style.fontSize = '0.9rem';
				statusBadge.style.borderRadius = '0.5rem';
				statusBadge.style.boxShadow = '0 4px 12px rgba(0, 0, 0, 0.25)';
				document.body.appendChild(statusBadge);
			}

			const recreatePreviewElement = () => {
				if (!previewElement) {
					return;
				}
				const parent = previewElement.parentElement;
				if (!parent) {
					return;
				}
				const newElement = document.createElement('material-beautify-chinese-study');
				Object.entries(baseAttributes).forEach(([name, value]) => {
					if (name === 'id') {
						newElement.id = value;
					} else {
						newElement.setAttribute(name, value);
					}
				});
				parent.replaceChild(newElement, previewElement);
				previewElement = newElement;
			};

			const cycleCards = () => {
				if (!previewElement) {
					return;
				}
				const currentCardType = playableCardTypes[cardTypeIndex];
				const currentOrientation = orientations[orientationIndex];

				if (lastOrientation === 'answer' && currentOrientation === 'question') {
					recreatePreviewElement();
				}

				previewElement.setAttribute('card-type', currentCardType);
				previewElement.setAttribute('card-orientation', currentOrientation);

				if (statusBadge) {
					statusBadge.textContent = `${currentCardType} – ${currentOrientation}`;
				}

				lastOrientation = currentOrientation;

				orientationIndex = (orientationIndex + 1) % orientations.length;
				if (orientationIndex === 0) {
					cardTypeIndex = (cardTypeIndex + 1) % playableCardTypes.length;
				}
			};

			cycleCards();
			setInterval(cycleCards, 4000);
		</script>
	</body>
</html>
